<html lang="en">
    <head>
        <!--meta-->
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <meta name="viewport" content="width=device-width, initial-scale=1">
        <!--title-->
        <title>Homicides in San Antonio in {{ object_list[0].app_year }}</title>
        <!--map code-->
            <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" />
            <script type="text/javascript" src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js?2"></script>
        <!--css/boostrap-->
            <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}" />
            <link rel="stylesheet" href="{{ url_for('static', filename='css/en-style.css') }}" />
        <!--datatables-->
        	<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.0/css/jquery.dataTables.css">
        	<!--use this jquery library for both bootstrap and datatables-->
        		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script> 
        	<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.0/js/jquery.dataTables.js"></script>
        	<script type="text/javascript" class="init">
        		$(document).ready( function () {
    				$('#example').DataTable( {
    					paging: false
    				} );
				} );
        	</script>
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->   
    </head>
    <body class="yearindex-page">
        <!--navigation-->
        <nav class="navbar navbar-inverse navbar-fixed-top">
                <div class="nav-tophat">
				<a id="nav-enlogo" href="http://mysanantonio.com/"></a>
				<div class="collapse navbar-collapse">
                    <div class="nav-container">
                    	<ul id="nav-links">
                            <li>
                                <a href="http://www.mysanantonio.com/news/local/">Local</a>
                            </li>
                            <li>
                                <a href="http://www.mysanantonio.com/news/politics/">Politics</a>
                            </li>   
                            <li>
                                <a href="http://www.mysanantonio.com/news/us-world/">U.S. & World</a>                           
                            </li>
                            <li>
                                <a href="http://www.mysanantonio.com/opinion/">Opinion</a>                          
                            </li>
                            <li>
                                <a href="http://www.mysanantonio.com/business/">Business</a>                            
                            </li>
                            <li>
                                <a href="http://www.mysanantonio.com/sports/">Sports</a>                            
                            </li>
                            <li>
                                <a href="http://www.mysanantonio.com/entertainment/">Arts</a>                           
                            </li>
                            <li>
                                <a href="http://www.mysanantonio.com/lifestyle/">Life</a>                           
                            </li>
                        </ul>
                    </div>    
                    </div>  
                </div>
        </nav>
        <!--end navigation block-->
        <div class="main-body">      
        <h1>San Antonio Homicides: {{ object_list[0].app_year }} </h1>
        
        <!--Subhead and chatter will go here with H2 or H3 styling-->
        <div id="map" style="width:100%; height:425px;"></div>
        <p>
        <p>
        <table id="example" class="display">
        	<thead>    
            	<tr>
                	<th>Name</th>
                	<th>Date</th>
                	<th>Address</th>
                	<th>Cause of Death</th>
                	<th>Age</th>
                	<th>Race/Ethnicity</th>
            	</tr>
            </thead>
            <tbody>
        	{% for obj in object_list %}       
            	<tr>
                	<td><a href="{{ obj.HomicideNbr }}/">{{ obj.onlineName }}</a></td>
                	<td>{{ obj.IncidentDate }}</td>
                	<td>{{ obj.SapdADDRESS }}</td>
                	<td>{{ obj.METHOD|title }}</td>
                	<td>{{ obj.enAgeCalc }}</td>
                	<td>{{ obj.Race }}</td>
            	</tr>
        	{% endfor %}
        	</tbody>
        </table>
            <script type="text/javascript">
                var map = L.map('map').setView([29.4240317, -98.5137178], 10);
                var mapquestLayer = new L.TileLayer('http://{s}.mqcdn.com/tiles/1.0.0/map/{z}/{x}/{y}.png', {
                    maxZoom: 18,
                    attribution: 'Data, imagery and map information provided by <a href="http://open.mapquest.co.uk" target="_blank">MapQuest</a>,<a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors.',
                    subdomains: ['otile1','otile2','otile3','otile4']
                });

            map.addLayer(mapquestLayer);
            var data = {
              "type": "FeatureCollection",
              "features": [
                {% for obj in object_list %}
                {
                  "type": "Feature",
                  "properties": {
                    "full_name": "{{ obj.onlineName }}",
                    "id": "{{ obj.HomicideNbr }}"
                  },
                  "geometry": {
                    "type": "Point",
                    "coordinates": [{{ obj.X }}, {{ obj.Y }}]
                  }
                }{% if not loop.last %},{% endif %}
                {% endfor %}
              ]
            };

            console.log(data);
			
			var geojsonMarkerOptions = {
    			radius: 7,
    			fillColor: "#ff6600",
    			color: "#000",
    			weight: 1,
   				opacity: 1,
    			fillOpacity: 0.8
			};
			
			var dataLayer = L.geoJson(data, {
                pointToLayer: function (feature, latlng) {
        			return L.circleMarker(latlng, geojsonMarkerOptions);
        		},
                onEachFeature: function(feature, layer) {
                    layer.bindPopup(
                        '<a href="' + feature.properties.id + '/">' +
                            feature.properties.full_name +
                        '</a>'
                    );
                }
            });

            console.log(dataLayer);
            map.addLayer(dataLayer);
        </script>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
        <!-- Include all compiled plugins (below), or include individual files as needed -->
        <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>
        <!--Built with the help, both witting and unwitting, of the kind folks on The Los Angeles Times' data desk-->
    </div>
    </body>
</html>